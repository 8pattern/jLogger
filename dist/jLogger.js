!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("util"),require("fs"),require("path")):"function"==typeof define&&define.amd?define(["exports","util","fs","path"],t):t((e=e||self).jlogger={},e.util$1,e.fs,e.path)}(this,(function(e,t,n,o){"use strict";function r(e={},t={}){const n={...e,...t};return Object.keys(e).forEach(o=>{const i=e[o],s=t[o];"Object"===i.constructor.name&&s&&"Object"===s.constructor.name&&(n[o]=r(i,s))}),n}n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o;const i="object"==typeof global,s=i?{pid:process.pid}:{wid:function(e=1){return Math.floor(Math.random()*10**e)}(5),url:window.location.href.replace(window.location.origin,"")},c={category:{notice:"NOTICE",action:"ACTION",function:"FUNCTION"},level:{error:"ERROR",warn:"WARN",info:"INFO",debug:"DEBUG"},format:e=>JSON.stringify(e),printLevel:["debug","info","warn","error"]};function l(e,...n){let o="";return e.forEach((e,r)=>{const i=n[r];o+=e+(i?function e(n){if(t.isNullOrUndefined(n))return`${n}`;switch(typeof n){case"function":const t=n.name;return t?`-Function[${t}]-`:"-Function-";case"object":const o=n.constructor.name;switch(o){case"Object":return`{${Object.entries(n).map(([t,n])=>`${t}:${e(n)}`)}}`;case"Array":return`[${n.map(t=>e(t))}]`;default:return`-${o}-`}case"string":return`'${n}'`;default:return`${n}`}}(i):"")}),o}function a(e=Date.now(),t="yyyy-mm-dd HH:MM:ss.l"){const n="number"==typeof e?new Date(e):e;let o=t;const r={"y+":()=>n.getFullYear(),"m+":()=>n.getMonth()+1,"d+":()=>n.getDate(),"H+":()=>n.getHours(),"M+":()=>n.getMinutes(),"s+":()=>n.getSeconds(),l:()=>n.getMilliseconds()};for(let e in r)if(new RegExp(`(${e})`).test(o)){const t=r[e]();o=o.replace(RegExp.$1,(""+t).padStart(RegExp.$1.length,"0"))}return o}class f{constructor(e={}){this.config=e}getPrintContent(e){const{format:t}=this.config;return t?t(e):e.logContent}}const u={colorScheme:{DEBUG:["#274e13","#b6d7a8"],INFO:["#073763","#b6d7a8"],default:["#000000","#d3d3d3"]}};class g extends f{constructor(e={}){super(e),this.config={...super.config,...u,...e}}print(e){const t=this.getPrintContent(e),{level:n=null}=e,o=c.level,r={[o.debug]:console.debug,[o.info]:console.info,[o.warn]:console.warn,[o.error]:console.error,null:console.log}[n],{colorScheme:s}=this.config;if(s&&i){const[e,o]=s[n]||s.default;e||o?r(`%c${t}`,`${e?`color: ${e}`:""}${o?`background-color: ${o};`:""}`):r(t)}else r(t)}}const h={filePath:"./",fileName:`${a(Date.now(),"yyyy-mm-dd")}`,fileExtension:"log",childConfigRule:null};let d=1;const p={logTag:l,contentLengthFormat:function(e,n,o){if(n){const r=n,i=e.length;if(i<=r)return e;const s=Math.floor(r/2)+1,c=r-s,l=t.isUndefined(o)?` <<<... ${i-r} chars are ignored ...>>> `:o;return`${e.slice(0,s)}${l}${e.slice(-c)}`}return e},dateformat:a},m={Appender:f,ConsoleAppender:g,FileAppender:class extends f{constructor(e={}){super(e),this.config={...super.config,...h,...e},this.init()}init(){this.makeLogDir(this.config.filePath)}makeLogDir(e){return!!n.existsSync(e)||!!this.makeLogDir(o.dirname(e))&&(console.log(`the log dir didn't exist and it is created: ${e}`),n.mkdirSync(e),!0)}writeToFile(e,t){return new Promise((o,r)=>{n.appendFile(e,t,e=>{e?(console.error(`print log file error: ${e}`),r(e)):o()})})}print(e){const t=this.getPrintContent(e);let n=!1;const{filePath:o,fileName:r,fileExtension:i,childConfigRule:s}=this.config;if(s){const c="function"==typeof s?s(e):s,{filePath:l=o,fileName:a=r,fileExtension:f=i,only:u=!1}=c;this.writeToFile(`${l}/${a}.${f}`,t),n=u}n||this.writeToFile(`${o}/${r}.${i}`,t)}}};e.appender=m,e.default=class{constructor(e={},t={}){this.logAppenders=[new g],this.args=r(s,e),this.config=r(c,t),this.logWrap=this.logWrap.bind(this),this.logDecorator=this.logDecorator.bind(this),this.init()}init(){const e=this.config.level;Object.keys(e).forEach(t=>{this[t]||(this[t]=function(n="",o={}){return this.log(n,{level:e[t],...o})})})}print(e={}){this.logAppenders.forEach(t=>{t.print(e)})}setAppender(e=[]){this.logAppenders=e}log(e="",t={}){const n={level:this.config.level.info,...this.args,...t,timeStamp:Date.now(),count:d,content:e};if(this.config.printLevel&&this.config.printLevel.includes[this.config.level[n.level]]){try{const e=this.config.format(n);this.print({...n,logContent:e})}catch(e){console.error(`something wrong in log: ${e}`)}return d+=1,n}return{}}debug(e="",t={}){return this.log(e,{level:this.config.level.debug,...t})}info(e="",t={}){return this.log(e,{level:this.config.level.info,...t})}warn(e="",t={}){return this.log(e,{level:this.config.level.warn,...t})}error(e,t={}){if(e instanceof Error){const{name:n="",message:o="",stack:r=""}=e;return this.log(r,{level:this.config.level.error,errType:n,errDesc:o,...t})}return this.log(e,{level:this.config.level.error,...t})}logWrap(e,t={}){const n=this;return function(...o){const r=e.name||"";n.info(l`INPUT: ${o}`,{category:n.config.category.function,funName:r,...t});try{const i=e(...o);return n.info(l`OUTPUT: ${o}`,{category:n.config.category.function,funName:r,...t}),i}catch(e){n.error(e,{category:n.config.category.function,funName:r,...t})}}}logDecorator(e={}){return(t,n,o)=>{const r=t.constructor.name,i=o.value;return i&&(o.value=this.logWrap(i,{className:r,...e})),o}}},e.util=p,Object.defineProperty(e,"__esModule",{value:!0})}));
